<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TicTacToe.py Source</title>
<style>
body {
    font-family: Menlo, Consolas, monospace;
    background: #f5f5f5;
    padding: 20px;
}
pre {
    background: #fff;
    padding: 20px;
    border: 1px solid #ccc;
    overflow-x: auto;
}
h1 {
    font-family: sans-serif;
}
</style>
</head>
<body>

<h1>TicTacToe.py</h1>
<p>This file shows the Pythonista UI Tic-Tac-Toe source code.</p>

<pre>
# TicTacToe.py - Pythonista UI app
# Run this in Pythonista (iPhone/iPad)
#
# Features:
#  - 3x3 touch UI
#  - Local two-player pass-and-play
#  - Single-player vs AI (unbeatable Minimax)
#  - New Game / Undo

import ui
import dialogs
import random
import copy

# -----------------------
# Game logic
# -----------------------
WIN_LINES = [
    (0,1,2),(3,4,5),(6,7,8),  # rows
    (0,3,6),(1,4,7),(2,5,8),  # cols
    (0,4,8),(2,4,6)           # diags
]

def check_winner(board):
    """Return 'X' or 'O' if winner, 'draw' if full and no winner, else None."""
    for a,b,c in WIN_LINES:
        if board[a] and board[a] == board[b] == board[c]:
            return board[a]
    if all(cell != "" for cell in board):
        return "draw"
    return None

def available_moves(board):
    return [i for i,v in enumerate(board) if v == ""]

def minimax(board, player, maximizing):
    """Minimax returns (score, move_index).
       Scores: +1 = X win, -1 = O win, 0 = draw (we assume AI player is 'O' or 'X' depending)"""
    winner = check_winner(board)
    if winner == "X":
        return (1, None)
    elif winner == "O":
        return (-1, None)
    elif winner == "draw":
        return (0, None)

    moves = available_moves(board)
    best_move = None
    if maximizing:
        best_score = -999
        for m in moves:
            board[m] = "X"
            score, _ = minimax(board, "O", False)
            board[m] = ""
            if score > best_score:
                best_score = score
                best_move = m
        return (best_score, best_move)
    else:
        best_score = 999
        for m in moves:
            board[m] = "O"
            score, _ = minimax(board, "X", True)
            board[m] = ""
            if score < best_score:
                best_score = score
                best_move = m
        return (best_score, best_move)

# -----------------------
# UI App
# -----------------------
class TicTacToeApp(ui.View):
    def __init__(self):
        self.name = "Tic-Tac-Toe"
        self.background_color = 'white'
        self.board = [""] * 9
        self.turn = "X"          # 'X' starts
        self.vs_ai = False
        self.ai_player = "O"     # if vs_ai True, AI plays 'O' by default
        self.history = []        # list of (idx, player) for undo

        # Status label
        self.status = ui.Label(frame=(10,10,300,40))
        self.status.font = ('<System>', 18)
        self.status.alignment = ui.ALIGN_CENTER
        self.add_subview(self.status)
